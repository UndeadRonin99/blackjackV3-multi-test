@page
@model MultiplayerGameModel
@{
    ViewData["Title"] = "Multiplayer Blackjack";
}

<div class="container-fluid mt-4">
  <div class="row">
<div class="col-12">
<div class="d-flex justify-content-between align-items-center mb-3">
 <h2>Multiplayer Blackjack - Table: @Model.TableId</h2>
     <div>
 <span class="badge bg-primary me-2" id="playerName">@Model.PlayerName</span>
     <button class="btn btn-sm btn-outline-secondary" id="shareTableBtn">
      <i class="bi bi-share"></i> Share Table
    </button>
     </div>
   </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="row mb-3">
  <div class="col-12">
         <div id="connectionStatus" class="alert alert-info">
           <span id="statusText">Connecting to game server...</span>
            </div>
  </div>
    </div>

    <!-- Dealer Section -->
    <div class="row mb-4">
        <div class="col-12">
        <div class="card bg-dark text-white">
     <div class="card-body">
   <h5 class="card-title">Dealer 
  <span class="badge bg-secondary" id="dealerTotal">0</span>
    </h5>
   <div id="dealerHand" class="card-container d-flex gap-2 flex-wrap">
    <!-- Dealer cards will be inserted here -->
     </div>
      </div>
  </div>
    </div>
    </div>

    <!-- Players Section -->
    <div class="row">
    <div class="col-12">
     <div class="card">
      <div class="card-body">
       <h5 class="card-title">Players at Table</h5>
  <div id="playersContainer" class="row g-3">
  <!-- Player cards will be inserted here -->
          </div>
 </div>
            </div>
     </div>
    </div>

 <!-- Current Player Controls -->
    <div class="row mt-4">
<div class="col-12">
            <div class="card border-primary">
      <div class="card-body">
  <h5 class="card-title">Your Game</h5>
           
       <!-- Message Display -->
        <div id="gameMessage" class="alert alert-info mb-3">
        Place your bet to start!
          </div>

    <!-- Bet Controls -->
 <div id="betControls" class="mb-3">
  <div class="row align-items-center">
     <div class="col-md-4">
  <label for="betAmount" class="form-label">Bet Amount</label>
       <input type="number" class="form-control" id="betAmount" 
     min="10" max="200" value="50" step="10">
 </div>
     <div class="col-md-4">
    <label class="form-label">Balance</label>
            <div class="h4 text-success" id="playerBalance">$1000</div>
           </div>
     <div class="col-md-4">
     <button class="btn btn-success btn-lg w-100" id="placeBetBtn">
Place Bet & Ready Up
     </button>
  </div>
 </div>
   </div>

 <!-- Game Action Controls -->
   <div id="gameControls" class="btn-group w-100" role="group" style="display: none;">
             <button class="btn btn-primary btn-lg" id="hitBtn">Hit</button>
   <button class="btn btn-warning btn-lg" id="standBtn">Stand</button>
 <button class="btn btn-info btn-lg" id="doubleBtn">Double</button>
       </div>

            <!-- Next Round Button -->
       <div id="nextRoundControls" class="mt-3" style="display: none;">
   <button class="btn btn-success btn-lg w-100" id="nextRoundBtn">
     Ready for Next Round
  </button>
        </div>

       <!-- Waiting for Players -->
 <div id="waitingMessage" class="alert alert-warning mt-3" style="display: none;">
               <div class="spinner-border spinner-border-sm me-2" role="status">
     <span class="visually-hidden">Loading...</span>
            </div>
     Waiting for other players...
      </div>
 </div>
 </div>
 </div>
    </div>
</div>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog">
    <div class="modal-content">
         <div class="modal-header">
    <h5 class="modal-title">Share Table Link</h5>
       <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
  </div>
   <div class="modal-body">
<p>Share this link with friends to join your table:</p>
         <div class="input-group">
     <input type="text" class="form-control" id="shareLink" readonly>
  <button class="btn btn-primary" id="copyLinkBtn">Copy</button>
          </div>
 </div>
    </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/multiplayer-game.css" asp-append-version="true">

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.14/signalr.min.js"></script>
    <script src="~/js/multiplayer-game.js" asp-append-version="true"></script>
    <script>
     // Initialize the game
        const tableId = '@Model.TableId';
 const playerName = '@Model.PlayerName';
        
      // Set share link
      const shareLink = window.location.origin + '/MultiplayerGame?tableId=' + tableId;
        document.getElementById('shareLink').value = shareLink;
        
        // Initialize game client
     window.gameClient = new MultiplayerGameClient(tableId, playerName);
    window.gameClient.start();
    </script>
}
